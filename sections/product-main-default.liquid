{% comment %}
  Product main section with image gallery and product info
{% endcomment %}

{%- liquid
  assign thumb_size = 86

  comment
    Prepare product gallery thumbnails and main images
  endcomment
  assign product_gallery_thumbs_wrapper = ''
  assign product_gallery_images_wrapper = ''
  for image in product.images
    assign variant = product.variants | where: 'featured_image', image | first
    assign variant_image = variant.featured_image | default: image
    assign is_first = forloop.first
    assign index = forloop.index0

    comment
      Product gallery thumbnails
    endcomment
    capture product_gallery_thumbs
      if variant_image == blank
        continue
      endif
      assign class_gallery_thumb = 'product-gallery__thumb'
      if is_first
      assign class_gallery_thumb = class_gallery_thumb | append: ' active'
      endif
      assign attr_gallery_thumb = 'fetchpriority="high"' | append: 'data-variant-id="' | append: variant.id | append: '" data-index="' | append: index | append: '" fetchpriority="high"'
      render 'image', image: variant_image, class: class_gallery_thumb, width: thumb_size, height: thumb_size, crop: 'center', w_min: thumb_size, w_max: thumb_size, attr: attr_gallery_thumb, wrapper: false
    endcapture
    assign product_gallery_thumbs_wrapper = product_gallery_thumbs_wrapper | append: product_gallery_thumbs

    comment
      Product gallery main images
    endcomment
    capture product_gallery_images
      assign class_gallery_image = 'product-gallery__image'
      assign attr_gallery_image = 'loading="lazy"'
      if is_first
        assign class_gallery_image = class_gallery_image | append: ' active'
        assign attr_gallery_image = 'fetchpriority="high"'
      endif
      render 'image', image: variant_image, class: class_gallery_image, width: 582, height: 582, crop: 'center', w_min: 448, w_max: 1206, attr: attr_gallery_image, wrapper: false
    endcapture
    assign product_gallery_images_wrapper = product_gallery_images_wrapper | append: '<figure class="product-gallery__image ' 
    if is_first
      assign product_gallery_images_wrapper = product_gallery_images_wrapper | append: 'active '
    endif
    assign product_gallery_images_wrapper = product_gallery_images_wrapper | append: '" data-index="' | append: index | append: '">'
    assign product_gallery_images_wrapper = product_gallery_images_wrapper | append: product_gallery_images
    assign product_gallery_images_wrapper = product_gallery_images_wrapper | append: '</figure>'
  endfor
-%}

<div class="product-main">
  <div class="product-main__container container">
    <!-- Product Images -->
    <div class="product-main__gallery">
      <!-- Thumbnail Images (Left Side) -->
      <figure class="product-gallery__thumbs">
        {{ product_gallery_thumbs_wrapper }}
      </figure>

      <!-- Main Image -->
      <div class="product-gallery__main">
        <div class="product-gallery__images">
          {{ product_gallery_images_wrapper }}
        </div>
      </div>
    </div>

    <!-- Product Info -->
    <div class="product-main__info">
      <h1 class="product-info__title">{{ product.title }}</h1>

      <div class="product-info__featured-description">
        Our best selling toilet! All Caroma's best features in one - Comfort height, rimless flush, antimicrobial protection - cleaner, easier, and more hygienic.
      </div>

      <div class="product-info__price">
        {% if product.compare_at_price > product.price %}
          <s class="product-price__compare">{{ product.compare_at_price | money }}</s>
          <strong class="product-price__sale">{{ product.price | money }}</strong>
          <span class="product-price__off">
            {%- liquid
              comment
                echo product.compare_at_price | minus: product.price | abs | money
              endcomment
              assign discount_percentage = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price | round
              echo '(' | append: discount_percentage | append: '%) off'
            -%}
          </span>
        {% else %}
          <span class="price--regular">{{ product.price | money }}</span>
        {% endif %}
      </div>

      {% liquid
        assign collections_title = product.collections | map: 'title' | join: ', '
        if collections_title contains 'SALE'
          for collection in product.collections
            if collection.title == 'SALE'
              assign description = collection.description | strip_html | strip_newlines
              render 'upsell-countdown', end_date: "2025-12-08T23:59:59Z", message_before: description, message_after: "The sale has ended.", class: "product-info__countdown"
            endif
          endfor
        endif
      %}

      <!-- Product Variant Selector -->
      {% if product.variants.size > 1 %}
        <div class="product-form__variant-selector" data-variant-id={{ product.selected_or_first_available_variant.id }}>
          {% for option in product.options %}
            <div class="product-form__option-group">
              {% assign option_name = 'option' | append: forloop.index %}
              {% assign variant_option_selected = product.selected_or_first_available_variant[option_name] %}
              {% assign option_values = '' %}
              {% assign option_values = product.variants | map: option_name | uniq %}

              <label class="product-form__label">{{ option }}: <strong>{{ variant_option_selected }}</strong></label>
              <div class="product-form__options">
                {% for value in option_values %}
                  {% assign variant = product.variants | find: option_name, value %}
                  {% assign image = variant.featured_image %}

                  <figure class="product-form__option">
                    {% assign attr_option = 'fetchpriority="high"' | append: '" data-option-name="' | append: value | append: '"' %}
                    {% assign class_option = 'product-option__image' %}
                    {% if variant_option_selected == value %}
                      {% assign class_option = class_option | append: ' selected' %}
                    {% endif %}
                    {% if image %}
                      {% render 'image',
                        image: image,
                        alt: value,
                        class: class_option,
                        width: thumb_size,
                        height: thumb_size,
                        crop: 'center',
                        w_min: thumb_size,
                        w_max: thumb_size,
                        attr: attr_option,
                        wrapper: false
                      %}
                    {% else %}
                      <div class="product-option__label {{ class_option }}" {{ attr_option }}>{{ value }}</div>
                    {% endif %}
                    {% comment %} <span class="product-form__label">{{ value }}</span> {% endcomment %}
                  </figure>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Product Form -->
      {% form 'product', product, class: 'product-main__form' %}
        {% assign current_variant = product.selected_or_first_available_variant %}

        <!-- Hidden input for selected variant -->
        <input type="hidden" name="id" id="selected-variant-id" value="{{ current_variant.id }}">

        <!-- Quantity & Add to Cart -->
        <div class="product-form__actions">
          <button
            type="submit"
            class="product-main__add-to-cart button"
            {% unless current_variant.available %}
              disabled
            {% endunless %}
          >
            {% if current_variant.available %}
              {{ 'products.add_to_cart' | t }}
            {% else %}
              {{ 'products.sold_out' | t }}
            {% endif %}
          </button>

          <div class="product-form__quantity">
            {% render 'quantity-selector', 
              style_variant: 'standard',
              input_name: 'quantity',
              initial_value: 1,
              min_value: 1,
              max_value: 999,
              show_total: false,
              unique_id: 'product-quantity'
            %}
          </div>

          <button type="button" class="product-main__wishlist button outline" aria-label="Add to wishlist">
            {% render 'icon-or-image', icon: 'heart', width: 24 %}
          </button>

          <button type="button" class="product-main__compare button outline" aria-label="Add to compare" hidden>
            {% render 'icon-or-image', icon: 'repeat', width: 24 %}
          </button>
        </div>

        {{ form | payment_button }}
      {% endform %}

      <!-- Trust Badges -->
      {% comment %}
        <div class="product__trust-badges">
          <img src="https://cdn.shopify.com/s/files/1/0533/2089/files/mcafee-secure.svg" alt="McAfee Secure" loading="lazy">
          <img src="https://cdn.shopify.com/s/files/1/0533/2089/files/norton-secured.svg" alt="Norton Secured" loading="lazy">
          <img src="https://cdn.shopify.com/s/files/1/0533/2089/files/verisign.svg" alt="VeriSign" loading="lazy">
          <img src="https://cdn.shopify.com/s/files/1/0533/2089/files/truste.svg" alt="TRUSTe" loading="lazy">
        </div>
      {% endcomment %}

      <!-- Product Meta Tabs -->
      <div class="product__meta-tabs">
        <button class="meta-tab active" data-tab="size-guide">{{ 'products.size_guide' | t }}</button>
        <button class="meta-tab" data-tab="delivery">{{ 'products.delivery_return' | t }}</button>
        <button class="meta-tab" data-tab="question">{{ 'products.ask_question' | t }}</button>
      </div>

      <!-- Product Meta -->
      <div class="product__meta">
        <div class="product__availability">
          <strong>{{ 'products.availability' | t }}:</strong>
          <span class="{% if current_variant.available %}in-stock{% else %}out-of-stock{% endif %}">
            {% if current_variant.available -%}
              {{- 'products.in_stock' | t -}}
            {%- else -%}
              {{- 'products.out_of_stock' | t -}}
            {%- endif %}
          </span>
        </div>

        {% if product.vendor %}
          <div class="product__vendor">
            <strong>{{ 'products.vendor' | t }}:</strong>
            <span>{{ product.vendor }}</span>
          </div>
        {% endif %}

        {% if product.type %}
          <div class="product__type">
            <strong>{{ 'products.categories' | t }}:</strong>
            <span>{{ product.type }}</span>
          </div>
        {% endif %}

        {% if product.tags.size > 0 %}
          <div class="product__tags">
            <strong>{{ 'products.tags' | t }}:</strong>
            <span>
              {% for tag in product.tags limit: 5 %}
                {{ tag -}}
                {%- unless forloop.last %}, {% endunless %}
              {% endfor %}
            </span>
          </div>
        {% endif %}
      </div>

      <!-- Social Share -->
      <div class="product-info__share">
        <a
          href="https://www.facebook.com/sharer.php?u={{ shop.url }}{{ product.url }}"
          target="_blank"
          aria-label="Share on Facebook"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
        </a>
        <a
          href="https://twitter.com/share?url={{ shop.url }}{{ product.url }}&text={{ product.title }}"
          target="_blank"
          aria-label="Share on Twitter"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
          </svg>
        </a>
        <a
          href="https://pinterest.com/pin/create/button/?url={{ shop.url }}{{ product.url }}&media={{ product.featured_image | image_url }}&description={{ product.title }}"
          target="_blank"
          aria-label="Share on Pinterest"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/>
          </svg>
        </a>
        <a
          href="https://www.tumblr.com/share/link?url={{ shop.url }}{{ product.url }}&name={{ product.title }}"
          target="_blank"
          aria-label="Share on Tumblr"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/>
          </svg>
        </a>
        <a
          href="https://telegram.me/share/url?url={{ shop.url }}{{ product.url }}&text={{ product.title }}"
          target="_blank"
          aria-label="Share on Telegram"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
          </svg>
        </a>
        <a href="mailto:?subject={{ product.title }}&body={{ shop.url }}{{ product.url }}" aria-label="Share via Email">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
        </a>
        <a
          href="https://api.whatsapp.com/send?text={{ product.title }}%20{{ shop.url }}{{ product.url }}"
          target="_blank"
          aria-label="Share on WhatsApp"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
        </a>
      </div>
    </div>
  </div>

  <div class="product-description">
    <div class="product-description__wrapper container">
      <div class="product-description__header">
        <h2 class="product-description__title">Product Details</h2>
        <div class="product-description__divider"></div>
      </div>
      
      <div class="product-description__content">
        {{ product.description }}
      </div>
      
      {% if product.metafields.custom.specifications %}
        <div class="product-description__specs">
          <h3 class="specs__title">Specifications</h3>
          <div class="specs__grid">
            {% for spec in product.metafields.custom.specifications.value %}
              <div class="spec__item">
                <span class="spec__label">{{ spec.name }}</span>
                <span class="spec__value">{{ spec.value }}</span>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      
      {% if product.metafields.custom.features %}
        <div class="product-description__features">
          <h3 class="features__title">Key Features</h3>
          <ul class="features__list">
            {% for feature in product.metafields.custom.features.value %}
              <li class="feature__item">
                <svg class="feature__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
                {{ feature }}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% stylesheet %}
  /* Product Main Styles */
  .product-main {
    --border-radius: 4px;
  }

  .product-main__container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
  }

  /* Product Gallery Styles */
  .product-main__gallery {
    display: flex;
    flex-direction: column-reverse;
    gap: 1rem;
    position: sticky;
    top: 1rem;
    align-self: flex-start;
  }

  .product-main__gallery:hover .product-gallery__thumbs {
    overflow-x: auto;
    padding-bottom: 0;
  }

  .product-gallery__thumbs {
    display: flex;
    gap: 0.75rem;
    max-height: 574px;
    overflow-x: hidden;
    padding-bottom: 15px;
  }

  .product-gallery__thumb {
    width: 90px;
    height: 90px;
    border: 2px solid transparent;
    padding: 2px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: border-color 0.3s;
    object-fit: cover;
  }

  .product-gallery__thumb:hover,
  .product-gallery__thumb.active {
    border-color: var(--color-primary);
  }

  .product-gallery__main {
    flex: 1;
    border-radius: var(--border-radius);
    overflow: hidden;
  }

  .product-gallery__images {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }

  .product-gallery__image {
    flex: 0 0 100%;
    margin: 0;
  }

  .product-gallery__image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .product-main__info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Product Info Styles */
  .product-info__title {
    font-size: 32px;
    font-weight: normal;
    color: var(--color-text);
    margin: 0;
    line-height: 1.2;
  }
  
  .product-info__featured-description {
    color: #666;
    font-size: 14px;
    line-height: 1.5;
  }

  /* Product Price Styles */
  .product-info__price {
    display: flex;
    align-items: center;
    gap: .75rem;
    line-height: 1.5rem;
  }

  .product-price__compare {
    font-size: 24px;
    color: #999;
  }

  .product-price__sale {
    font-size: 24px;
    color: var(--color-text);
  }

  .product-price__off {
    font-size: 18px;
    color: #d9534f;
    font-weight: bold;
  }

  /* Product Form Styles */
  .product-form__variant-selector {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .product-form__option-group {
    display: flex;
    flex-direction: column;
    gap: .5rem;
    padding-bottom: 1rem;
    border-bottom: 1px hsl(from var(--color-border) h s l) solid;
  }

  .product-form__label {
    font-size: 14px;
    color: var(--color-text);
    letter-spacing: 0.5px;
  }

  .product-form__options {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .product-form__option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    border: 2px solid transparent;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .product-form__option:hover {
    border-color: var(--color-primary);
  }

  .product-form__option:has(.selected) {
    border-color: var(--color-primary);
    background-color: rgba(var(--color-primary), 0.05);
  }

  .product-form__option:has(.selected) .product-form__label {
    color: var(--color-primary);
  }

  .product-form__option.unavailable {
    opacity: 0.5;
    cursor: not-allowed;
    position: relative;
  }

  .product-form__option.unavailable::after {
    content: '';
    position: absolute;
    top: 8px;
    left: -8px;
    width: 100%;
    height: 2px;
    background-color: #dc3545;
    transform: rotate(-45deg) scaleX(0);
    transform-origin: right center;
    animation: strikethrough 0.3s ease-out forwards;
  }

  @keyframes strikethrough {
    0% {
      transform: rotate(-45deg) scaleX(0);
    }
    100% {
      transform: rotate(-45deg) scaleX(1);
    }
  }

  .product-form__option .product-form__label {
    font-size: 12px;
    font-weight: normal;
    color: #666;
    text-align: center;
    text-transform: none;
    letter-spacing: normal;
  }

  .product-option__image {
    width: 64px;
    height: auto;
    object-fit: cover;
    border-radius: var(--border-radius);
    border: 2px solid #fff;
    background-color: hsl(from var(--color-border) h s l);
  }

  .product-option__label {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    color: var(--color-text);
    border: 2px solid #fff;
    border-radius: var(--border-radius);
    background-color: hsl(from var(--color-border) h s l);
  }

  .product-form__actions {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .product-form__quantity {
    display: flex;
    align-items: center;
  }

  .product-main__add-to-cart {
    --color: var(--color-secondary);

    flex: 1;
    font-weight: bold;
  }

  .product-main__wishlist svg,
  .product-main__compare svg {
    width: 1.5rem;
  }

  .product-main__wishlist:hover,
  .product-main__compare:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }

  /* Product Meta Styles */
  .product__meta-tabs {
    display: flex;
    gap: 20px;
    border-bottom: 1px solid #eee;
  }

  .meta-tab {
    padding: 10px 0;
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    font-size: 14px;
    color: #666;
    cursor: pointer;
    transition: all 0.3s;
  }

  .meta-tab:hover,
  .meta-tab.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
  }

  .product__meta {
    display: flex;
    flex-direction: column;
    gap: 10px;
    font-size: 14px;
  }

  .product__meta > div {
    display: flex;
    gap: 8px;
  }

  .product__meta strong {
    color: var(--color-text);
    min-width: 100px;
  }

  .product__meta span {
    color: #666;
  }

  .in-stock {
    color: #28a745 !important;
  }

  .out-of-stock {
    color: #dc3545 !important;
  }

  .product-info__share {
    display: flex;
    gap: 12px;
    padding-top: 10px;
  }

  .product-info__share a {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    text-decoration: none;
    transition: color 0.3s;
  }

  .product-info__share a:hover {
    color: var(--color-primary);
  }

  .shopify-payment-button {
    margin-top: 12px;
  }

  /* Product Description Styles */
  .product-description {
    padding: 60px 0;
    background: var(--color-background-alt, #fafafa);
  }

  /* .product-description__wrapper {
    max-width: 800px;
    margin: 0 auto;
  } */

  .product-description__header {
    text-align: center;
    margin-bottom: 40px;
  }

  .product-description__title {
    font-size: 28px;
    font-weight: 600;
    color: var(--color-text);
    margin: 0 0 20px 0;
    line-height: 1.3;
  }

  .product-description__divider {
    width: 60px;
    height: 3px;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    margin: 0 auto;
    border-radius: 2px;
  }

  .product-description__content {
    font-size: 16px;
    line-height: 1.7;
    color: var(--color-text-secondary, #666);
    margin-bottom: 40px;
  }

  .product-description__content h1,
  .product-description__content h2,
  .product-description__content h3,
  .product-description__content h4,
  .product-description__content h5,
  .product-description__content h6 {
    color: var(--color-text);
    font-weight: 600;
    margin: 30px 0 15px 0;
    line-height: 1.4;
  }

  .product-description__content h1 { font-size: 24px; }
  .product-description__content h2 { font-size: 22px; }
  .product-description__content h3 { font-size: 20px; }
  .product-description__content h4 { font-size: 18px; }

  .product-description__content p {
    margin: 0 0 20px 0;
  }

  .product-description__content ul,
  .product-description__content ol {
    margin: 20px 0;
    padding-left: 30px;
  }

  .product-description__content li {
    margin-bottom: 8px;
    line-height: 1.6;
  }

  .product-description__content strong {
    font-weight: 600;
    color: var(--color-text);
  }

  .product-description__content a {
    color: var(--color-primary);
    text-decoration: underline;
    transition: color 0.3s;
  }

  .product-description__content a:hover {
    color: var(--color-secondary);
  }

  .product-description__specs {
    background: #fff;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  .specs__title {
    font-size: 20px;
    font-weight: 600;
    color: var(--color-text);
    margin: 0 0 20px 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .specs__title::before {
    content: '';
    width: 4px;
    height: 20px;
    background: var(--color-primary);
    border-radius: 2px;
  }

  .specs__grid {
    display: grid;
    gap: 15px;
  }

  .spec__item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f0;
  }

  .spec__item:last-child {
    border-bottom: none;
  }

  .spec__label {
    font-weight: 500;
    color: var(--color-text);
    flex: 1;
  }

  .spec__value {
    color: var(--color-text-secondary, #666);
    text-align: right;
    flex: 1;
  }

  .product-description__features {
    background: #fff;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  .features__title {
    font-size: 20px;
    font-weight: 600;
    color: var(--color-text);
    margin: 0 0 20px 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .features__title::before {
    content: '';
    width: 4px;
    height: 20px;
    background: var(--color-secondary);
    border-radius: 2px;
  }

  .features__list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .feature__item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px 0;
    font-size: 15px;
    line-height: 1.6;
    color: var(--color-text-secondary, #666);
  }

  .feature__icon {
    color: var(--color-success, #28a745);
    flex-shrink: 0;
    margin-top: 2px;
  }

  @media (max-width: 991px) {
    .product-main__container {
      display: flex;
      flex-direction: column;
    }

    .product-gallery__thumbs {
      flex-direction: row;
      overflow-x: auto;
      max-height: none;
    }

    .product-main__gallery {
      position: relative;
      width: 100%;
    }

    .product-main__gallery:hover .product-gallery__thumbs {
      overflow-x: auto;
    }

    .product-gallery__thumb {
      flex-shrink: 0;
    }
  }

  @media (max-width: 768px) and (min-width: 577px) {
    .product-info__title {
      font-size: 28px;
    }

    .product-main__info {
      gap: 1.25rem;
    }

    .product-form__actions {
      flex-wrap: wrap;
      gap: 8px;
    }
  }

  @media (max-width: 576px) {
    .product-form__option .product-form__label {
      font-size: 11px;
    }

    .product-info__title {
      font-size: 24px;
      line-height: 1.3;
    }

    .product-info__featured-description {
      font-size: 13px;
    }

    .product-info__price {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    .product-price__compare {
      font-size: 20px;
    }

    .product-price__sale {
      font-size: 22px;
    }

    .product-price__off {
      font-size: 16px;
    }

    .product-form__actions {
      flex-wrap: wrap;
    }

    .product-main__add-to-cart {
      width: 100%;
      order: 1;
    }

    .product-form__quantity {
      order: 2;
    }

    .product-main__wishlist,
    .product-main__compare {
      order: 3;
    }

    .product__meta-tabs {
      overflow-x: auto;
    }

    .meta-tab {
      flex-shrink: 0;
    }

    .product-info__share {
      justify-content: center;
    }

    /* Product Description Mobile Styles */
    .product-description {
      padding: 40px 0;
    }

    .product-description__title {
      font-size: 24px;
    }

    .product-description__content {
      font-size: 15px;
      margin-bottom: 30px;
    }

    .product-description__specs,
    .product-description__features {
      padding: 20px;
      margin-bottom: 20px;
    }

    .specs__title,
    .features__title {
      font-size: 18px;
    }

    .spec__item {
      flex-direction: column;
      align-items: flex-start;
      gap: 5px;
      padding: 10px 0;
    }

    .spec__value {
      text-align: left;
    }

    .feature__item {
      font-size: 14px;
      padding: 10px 0;
    }
  }
{% endstylesheet %}

{% javascript %}
  class ImageGallery {
    constructor(thumbsSelector, imageWrapperSelector) {
      this.thumbs = thumbsSelector;
      this.imageWrapper = imageWrapperSelector;
      this.currentIndex = 0;
      this.init();
    }
    
    init() {
      this.onVariantChange('product-variant:changed');
      this.thumbs.forEach((thumb, index) => {
        thumb.addEventListener('click', () => this.onThumbClick(index));
      });
    }

    onThumbClick(index) {
      if (index === this.currentIndex) return;

      const translateX = -100 * index;
      this.imageWrapper.style.transform = `translateX(${translateX}%)`;

      this.thumbs.forEach((t) => t.classList.remove('active'));
      this.thumbs[index].classList.add('active');

      this.currentIndex = index;
      this.scrollToThumb(index);
    }

    onVariantChange(eventName) {
      document.addEventListener(eventName, (event) => {
        const targetThumb = this.getThumbByVariantId(event.detail.id);
        if (targetThumb) {
          const targetIndex = Array.from(this.thumbs).indexOf(targetThumb);
          this.onThumbClick(targetIndex);
        }
      });
    }

    getThumbByVariantId(variantId) {
      return Array.from(this.thumbs).find(thumb => 
        thumb.dataset.variantId == variantId
      );
    }

    scrollToThumb(index) {
      const thumb = this.thumbs[index];
      const thumbsContainer = thumb?.parentElement;
      
      if (thumb && thumbsContainer) {
        const thumbRect = thumb.getBoundingClientRect();
        const containerRect = thumbsContainer.getBoundingClientRect();
        
        // Check if mobile mode (horizontal layout)
        // const isMobile = window.innerWidth <= 991;
        
        // if (isMobile) {
          // Horizontal scroll for mobile
          const thumbCenter = thumbRect.left + thumbRect.width / 2;
          const containerCenter = containerRect.left + containerRect.width / 2;
          const scrollOffset = thumbCenter - containerCenter;
          
          thumbsContainer.scrollTo({
            left: thumbsContainer.scrollLeft + scrollOffset,
            behavior: 'smooth'
          });
        // } else {
        //   // Vertical scroll for desktop
        //   const thumbCenter = thumbRect.top + thumbRect.height / 2;
        //   const containerCenter = containerRect.top + containerRect.height / 2;
        //   const scrollOffset = thumbCenter - containerCenter;
          
        //   thumbsContainer.scrollTo({
        //     top: thumbsContainer.scrollTop + scrollOffset,
        //     behavior: 'smooth'
        //   });
        // }
      }
    }
  }

  class VariantSelector {
    constructor(wrapper) {
      // Variant selector properties
      this.wrapper = wrapper;
      this.options = this.wrapper.querySelectorAll('img');
      this.priceSale = document.querySelector('.product-price__sale');
      this.priceCompare = document.querySelector('.product-price__compare');
      this.priceOff = document.querySelector('.product-price__off');
      this.product = null;
      this.variant = null;
      
      // Availability management properties
      this.optionGroups = [];
      this.variantMatrix = {};
      this.currentSelection = [];
      
      this.init();
    }

    async init() {
      // Initialize product data
      await this.setProduct()

      // Initialize variant selector
      this.setVariant();

      // Initialize availability management
      this.initAvailabilityManager();

      this.options.forEach((option) => {
        option.addEventListener('click', () => this.onOptionClick(option));
      });
    }

    /**
     * Availability Management Methods
     */
    
    initAvailabilityManager() {
      this.buildOptionGroups();
      this.buildVariantMatrix();
      this.setInitialSelection();
      this.updateAllOptionsAvailability();
    }
    
    // Build option groups structure
    buildOptionGroups() {
      const groups = this.wrapper.querySelectorAll('.product-form__option-group');
      
      groups.forEach((group, groupIndex) => {
        const options = group.querySelectorAll('.product-option__image, .product-option__label');
        const optionValues = [];
        
        options.forEach(option => {
          optionValues.push({
            element: option,
            value: option.dataset.optionName,
            container: option.closest('.product-form__option')
          });
        });
        
        this.optionGroups.push({
          index: groupIndex,
          element: group,
          options: optionValues
        });
      });
    }
    
    // Build variant lookup matrix
    buildVariantMatrix() {
      if (!this.product?.variants) return;
      
      this.product.variants.forEach(variant => {
        const key = variant.options.join('_').toLowerCase().replace(/\s+/g, '-');
        this.variantMatrix[key] = {
          available: variant.available
        };
      });
    }
    
    // Set initial selection based on selected options
    setInitialSelection() {
      this.optionGroups.forEach((group, index) => {
        const selectedOption = group.options.find(opt => 
          opt.element.classList.contains('selected')
        );
        
        this.currentSelection[index] = selectedOption ? selectedOption.value : null;
      });
    }
    
    // Update selection when option is clicked
    updateAvailabilitySelection(groupIndex, optionValue) {
      this.currentSelection[groupIndex] = optionValue;
      this.updateAllOptionsAvailability();
    }
    
    // Check if a combination of options has available variant
    checkVariantAvailability(optionArray) {
      const key = optionArray.join('_').toLowerCase().replace(/\s+/g, '-');
      const variantData = this.variantMatrix[key];
      return variantData && variantData.available;
    }
    
    // Find variant by option combination
    findVariantByOptions(optionArray) {
      const key = optionArray.join('_').toLowerCase().replace(/\s+/g, '-');
      const variantData = this.variantMatrix[key];
      return variantData ? variantData.variant : null;
    }
    
    // Main availability update logic
    updateAllOptionsAvailability() {
      this.optionGroups.forEach((group, groupIndex) => {
        group.options.forEach(option => {
          // Create a copy of current selection
          const optionSelection = [...this.currentSelection];
          optionSelection[groupIndex] = option.value;
          
          // Check availability
          const isAvailable = this.checkVariantAvailability(optionSelection);
          
          // Update UI
          option.container.classList.toggle('unavailable', !isAvailable);
        });
      });
    }
    
    /**
     * Variant Selector Methods
     */

    // Fetch product data by handle
    async getProduct(params) {
      const pathSegments = window.location.pathname.split('/');
      const handle = pathSegments[pathSegments.length - 1];
      if (!handle) return null;

      try {
        const response = await fetch(`${window.Shopify.routes.root}products/${handle}.js`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data;
      } catch (error) {
        console.warn(`Error fetching data for handle "${handle}", please check if the product handle is correct:`, error);
        return {
          'message': 'Error fetching data for handle',
          'status': 'error',
          'handle': handle,
          'error': error
        };
      }
    }

    async setProduct() {
      this.product = await this.getProduct();
    }

    // Get currently selected variant based on selected options
    getVariant() {
      const selectedOptions = [];
      this.options.forEach((option) => {
        if (option.classList.contains('selected')) {
          selectedOptions.push(option.dataset.optionName);
        }
      });

      if (!this.product || !this.product.variants) return null;

      return this.product.variants.find((variant) => {
        return variant.options.every((option, index) => option === selectedOptions[index]);
      }) || null;
    }

    // Set the current variant
    setVariant() {
      this.variant = this.getVariant();
    }

    // Handle option click event
    onOptionClick(option) {
      if (option.closest('.product-form__option').classList.contains('unavailable')) {
        return; // Do nothing if option is unavailable
      }
      this.setOptionsSelected(option);
      
      // Update availability management selection
      const groupIndex = this.getOptionGroupIndex(option);
      const optionValue = option.dataset.optionName;
      this.updateAvailabilitySelection(groupIndex, optionValue);
      
      this.setVariant();
      if (this.variant) {
        this.setUrlParameter('variant', this.variant.id);
        this.setPrice();
        this.setOptionLabel();
        this.dispatchVariantChangeEvent(this.variant);
      }
    }

    // Get index of the option group
    getOptionGroupIndex(option) {
      const optionGroup = option.closest('.product-form__option-group');
      const allGroups = this.wrapper.querySelectorAll('.product-form__option-group');
      return Array.from(allGroups).indexOf(optionGroup);
    }

    // Set selected class on the chosen option
    setOptionsSelected(option) {
      const imageGroup = option.closest('.product-form__option-group').querySelectorAll('img, .product-option__label');
      imageGroup.forEach((opt) => opt.classList.remove('selected'));
      option.classList.add('selected');
    }

    // Update URL parameter without reloading the page
    setUrlParameter(param, value) {
      const url = new URL(window.location);
      url.searchParams.set(param, value);
      window.history.replaceState({}, '', url);
    }

    // Update price display based on selected variant
    setPrice() {
      const variantPriceSale = this.variant.price;
      const variantPriceCompare = this.variant.compare_at_price;
      const offPercentage = this.priceOffPercentage(variantPriceCompare, variantPriceSale);
      if (this.priceSale && this.priceCompare) {
        this.priceSale.textContent = this.priceFormatter(variantPriceSale);
        this.priceCompare.textContent = this.priceFormatter(variantPriceCompare);
        if (offPercentage > 0) {
          this.priceOff.textContent = `(${offPercentage}%) off`;
          this.priceOff.style.display = 'inline';
        } else {
          this.priceOff.style.display = 'none';
        }
      }
    }

    // Update option labels to show selected values
    setOptionLabel() {
      this.wrapper.querySelectorAll('.product-form__label strong').forEach((label, index) => {
        const selectedOption = this.variant.options[index] || 'Select';
        label.textContent = selectedOption;
      });
    }

    // Calculate percentage off
    priceOffPercentage(originalCents, saleCents) {
      if (!originalCents || originalCents <= saleCents) return 0;
      return Math.round(((originalCents - saleCents) / originalCents) * 100);
    }

    // Format price from cents to currency string
    priceFormatter(cents) {
      const dollars = cents / 100;
      return dollars.toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD',
      });
    }

    // Dispatch custom event on variant change
    dispatchVariantChangeEvent(variant) {
      const event = new CustomEvent('product-variant:changed', { detail: variant });
      document.dispatchEvent(event);
    }
  }

  document.addEventListener('DOMContentLoaded', async function () {
    // Image Gallery
    const thumbs = document.querySelectorAll('.product-gallery__thumb');
    const imageWrapper = document.querySelector('.product-gallery__images');
    const imageGallery = new ImageGallery(thumbs, imageWrapper);

    // Variant Selector With Images
    const variantOptionsWrapper = document.querySelector('.product-form__variant-selector');
    const variantSelector = new VariantSelector(variantOptionsWrapper);

    // Quantity controls are now handled by the quantity-selector block
  });
{% endjavascript %}

{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
