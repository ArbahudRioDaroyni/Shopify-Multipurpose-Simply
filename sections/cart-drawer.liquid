{% comment %}
  This section provides a cart drawer that can be triggered from anywhere
  in the theme. Similar to collection filters but for cart functionality.
{% endcomment %}

{% liquid
  capture cart_content
    render 'cart-sidebar'
  endcapture
%}

<!-- Cart Drawer -->
{% render 'slide-over',
  id: 'cart-drawer',
  position: 'right',
  size: 'lg',
  title: 'Shopping Cart',
  description: 'Review and manage your cart items',
  content: cart_content
%}

{% javascript %}
  class CartSlide {
    constructor() {
      this.init();
    }

    init() {
      document.addEventListener('cart:updated', () => this.refreshCartContent());
    }

    refreshCartContent() {
      // Refresh cart sidebar content
      fetch('/cart?section_id=cart-drawer')
        .then(response => response.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const newContent = doc.querySelector('.cart-sidebar-content');
          const currentContent = document.querySelector('.cart-sidebar-content');
          
          if (newContent && currentContent) {
            currentContent.innerHTML = newContent.innerHTML;

            if (newContent && currentContent) {
              currentContent.innerHTML = newContent.innerHTML;
              // Re-init CartItem for new elements
              const cartItems = document.querySelectorAll('.cart-item');
              cartItems.forEach(cartItem => {
                new window.theme.CartItem(cartItem);
              });
            }
          }
        })
        .catch(error => {
          console.error('Error refreshing cart:', error);
        });
    }

    openCartDrawer() {
      const cartDrawer = document.getElementById('cart-drawer');
      if (cartDrawer && cartDrawer.open) {
        cartDrawer.open();
      }
    }
  }

  // Initialize cart slide functionality
  document.addEventListener('DOMContentLoaded', () => {
    new CartSlide();
  });
{% endjavascript %}

{% schema %}
{
  "name": "Cart Drawer",
  "settings": [
    {
      "type": "header",
      "content": "Cart drawer settings"
    },
    {
      "type": "checkbox",
      "id": "show_cart_recommendations",
      "label": "Show product recommendations",
      "default": true,
      "info": "Display related products in the cart drawer"
    },
    {
      "type": "checkbox",
      "id": "enable_cart_notes",
      "label": "Enable cart notes",
      "default": true,
      "info": "Allow customers to add notes to their order"
    }
  ]
}
{% endschema %}